<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safari-Compatible Iframe Integration for Figma Sites</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .iframe-container {
            position: relative;
            width: 100%;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        
        .iframe-label {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10;
        }
        
        /* Safari-specific iframe styles */
        iframe {
            width: 100% !important;
            border: none !important;
            display: block !important;
            overflow: hidden !important;
            /* Safari: Prevent iframe scrolling */
            scrolling: no;
            /* Safari: Force hardware acceleration */
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }
        
        .section {
            padding: 30px;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçé Safari-Compatible Iframe Integration</h1>
            <p>Example implementation for Figma Sites with Safari fixes</p>
        </div>
        
        <div class="section">
            <div class="warning">
                <h3>‚ö†Ô∏è Safari Iframe Issues</h3>
                <p>Safari has known issues with iframe resizing in Figma Sites:</p>
                <ul>
                    <li>Stricter postMessage security policies</li>
                    <li>Different ResizeObserver behavior</li>
                    <li>Cross-origin communication limitations</li>
                    <li>Document height calculation differences</li>
                </ul>
            </div>
            
            <h2>üìã Implementation Steps</h2>
            
            <h3>Step 1: Add Safari Fix Script to Figma Sites</h3>
            <p>Copy and paste this code into your Figma Sites custom code section (in the &lt;head&gt; or before &lt;/body&gt;):</p>
            <div class="code-block">
// Copy the content from figma-iframe-safari-fix.js
// This script will automatically detect Safari and apply necessary fixes
            </div>
            
            <h3>Step 2: Update Your HTML Files</h3>
            <p>Ensure your iframe source HTML files have Safari-compatible scripts. Here are the key points:</p>
            
            <div class="success">
                <h4>‚úÖ Safari-Compatible Features</h4>
                <ul>
                    <li>Enhanced postMessage handling with Safari detection</li>
                    <li>Improved height calculation with fallbacks</li>
                    <li>Cross-browser compatible ResizeObserver usage</li>
                    <li>Debounced height reporting to prevent infinite loops</li>
                </ul>
            </div>
            
            <h3>Step 3: Test Your Iframes</h3>
            <p>Below are example iframes that should work correctly in Safari:</p>
            
            <!-- Example iframe implementations -->
            <div class="iframe-container">
                <div class="iframe-label">support.html</div>
                <iframe 
                    src="support.html" 
                    width="100%" 
                    height="400"
                    scrolling="no"
                    frameborder="0"
                    title="Support Demo">
                </iframe>
            </div>
            
            <div class="iframe-container">
                <div class="iframe-label">tags.html</div>
                <iframe 
                    src="tags.html" 
                    width="100%" 
                    height="400"
                    scrolling="no"
                    frameborder="0"
                    title="Tags Demo">
                </iframe>
            </div>
            
            <h3>Step 4: Debugging in Safari</h3>
            <p>Open Safari Developer Tools (Web Inspector) to monitor:</p>
            <ul>
                <li>Console messages from the Safari fix script</li>
                <li>PostMessage communication between iframe and parent</li>
                <li>Height change events and calculations</li>
                <li>Any security warnings or errors</li>
            </ul>
            
            <div class="code-block">
// Enable verbose logging in Safari Developer Tools
// Look for messages like:
// "Safari fix: Height set for support-html: 450px"
// "Safari fix: Message received: {type: 'setIframeHeight', ...}"
            </div>
        </div>
    </div>
    
    <!-- Include the Safari fix script -->
    <script src="figma-iframe-safari-fix.js"></script>
    
    <script>
        // Additional Safari-specific initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Safari iframe example page loaded');
            
            // Force iframe reinitialization after page load
            setTimeout(function() {
                const iframes = document.querySelectorAll('iframe');
                console.log(`Found ${iframes.length} iframes on page`);
                
                iframes.forEach((iframe, index) => {
                    // Ensure Safari-specific attributes are set
                    iframe.setAttribute('scrolling', 'no');
                    iframe.setAttribute('frameborder', '0');
                    iframe.style.overflow = 'hidden';
                    iframe.style.border = 'none';
                    
                    console.log(`Iframe ${index + 1} configured for Safari compatibility`);
                });
            }, 500);
        });
        
        // Safari-specific resize handling
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                console.log('Window resized, Safari iframes should adjust');
            }, 250);
        });
    </script>
</body>
</html> 